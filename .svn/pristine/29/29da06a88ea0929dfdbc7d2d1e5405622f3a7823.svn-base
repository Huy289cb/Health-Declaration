import React, { Component } from "react";
import {
  Dialog,
  Button,
  Grid,
  DialogTitle,
  DialogContent,
  FormControlLabel,
  Checkbox,
  DialogActions,
  Icon,
  IconButton,
  FormControl,
  FormLabel,
  FormHelperText,
  RadioGroup,
  Radio,
} from "@material-ui/core";
import { ValidatorForm, TextValidator } from "react-material-ui-form-validator";
import { getAllBasicInEdit, addNew, update, checkDuplicate } from "./Service";
import InputAdornment from "@material-ui/core/InputAdornment";
import Draggable from 'react-draggable';
import Paper from '@material-ui/core/Paper';
import { toast } from 'react-toastify';
import 'react-toastify/dist/ReactToastify.css';
import SaveIcon from '@material-ui/icons/Save';
import BlockIcon from '@material-ui/icons/Block';
import Autocomplete from "@material-ui/lab/Autocomplete";
import AsynchronousAutocomplete from "../utilities/AsynchronousAutocomplete";
import {
  getByPageByParentId as getAdministrativeUnitByPage,
  getUserById as getAdministrativeUnitById,
  searchByPage as getAdministrativeUnit
} from "../AdministrativeUnit/AdministrativeUnitService";
import "styles/globitsStyles.css";
import { searchByPage as getBackgroundDisease } from "../BackgroundDisease/BackgroundDiseaseService";

toast.configure({
  autoClose: 1000,
  draggable: false,
  limit: 3
});

function PaperComponent(props) {
  return (
    <Draggable handle="#draggable-dialog-title" cancel={'[class*="MuiDialogContent-root"]'}>
      <Paper {...props} />
    </Draggable>
  );
}

class EditorDialog extends Component {
  state = {
    isAddNew: false,
    id: null,
    name: "",
    code: "",
    level: 0,
    changePass: true,
    provinceOfResidenceSearch: {
      pageIndex: 0,
      pageSize: 10000000,
      isGetAllCity: true,
    },
    provinceOfResidence: null,
    districtOfResidence: null,
    districtOfResidenceSearch: {},
    wardOfResidenceSearch: {},
    wardOfResidence: null,
    residentialArea: null,
    residentialAreaSearch: {},
    administrativeUnit: null,
    hamletOfResidenceSearch: {},
    isPregnant: false,
  };
  validateSDT = (sdt) => {
    var cm = /^0[0-9]{9,10}$/
    if (sdt.match(cm)) {
      return true
    } else {
      return false;
    }
  }
  validateSoBHYT = (bhyt) => {
    var cm = /^[a-zA-Z0-9]+$/
    if (bhyt.match(cm)) {
      return true
    } else {
      return false;
    }
  }
  validateCMND = (cmnd) => {
    var cm = /^[0-9]{9,12}$/
    if (cmnd.match(cm)) {
      return true
    } else {
      return false;
    }
  }
  handleChange = (event, source) => {
    event.persist();
    if (source === "switch") {
      this.setState({ isActive: event.target.checked });
      return;
    }
    if (source === "changePass") {
      this.setState({ changePass: event.target.checked });
      return;
    }
    if (source != null && source == "gender") {
      let {gender} = this.state;
      gender = event.target.defaultValue;
      if (event.target.defaultValue == "M") {
        this.setState({isPregnant: false});
      }
      this.setState({ gender, radioErrorGender: false, radioHelperTextGender: "" });
      return;
    }
    if (source != null && source == "isPregnant") {
      this.setState({ isPregnant: event.target.checked })
      return;
    }
    this.setState({
      [event.target.name]: event.target.value
    });
  };

  handleFormSubmit = async () => {
    // await this.openCircularProgress();
    let { id, backgroundDiseases } = this.state;
    let { t } = this.props;
    let obj = {}
    if (this.state.gender === null || this.state.gender === undefined) {
      this.setState({
        radioHelperTextGender: "Đây là trường bắt buộc", radioErrorGender: true
      })
    } 
    else if (this.state.haveBackgroundDisease === null || this.state.haveBackgroundDisease === undefined) {
      this.setState({ radioHelperText: "Đây là trường bắt buộc", radioError: true })
    } 
    else {
      let listBackgroundDisease = [];
      if (backgroundDiseases) {
        backgroundDiseases.forEach(element => {
          listBackgroundDisease.push({ backgroundDisease: element });
        });
      }
      obj.id = id;
      obj.code = this.state.code;
      obj.name = this.state.name;
      obj.age = this.state.age;
      obj.phoneNumber = this.state.phoneNumber;
      obj.password = this.state.password;
      obj.detailAddress = this.state.detailAddress;
      obj.email = this.state.email;
      obj.familyMembers = this.state.familyMembers;
      obj.idCardNumber = this.state.idCardNumber;
      obj.healthInsuranceCardNumber = this.state.healthInsuranceCardNumber;
      obj.gender = this.state.gender;
      obj.isPregnant = this.state.isPregnant;
      obj.height = this.state.height;
      obj.weight = this.state.weight;
      obj.haveBackgroundDisease = this.state.haveBackgroundDisease;
      obj.listBackgroundDisease = listBackgroundDisease;
      if (this.state.administrativeUnit) {
        obj.administrativeUnit = { id: this.state.administrativeUnit.id };
      }
      if (this.state.phoneNumber != null && this.validateSDT(this.state.phoneNumber) == false) {
        toast.warning("Số điện thoại không hợp lệ");
      } else if (this.state.healthInsuranceCardNumber != null && this.validateSoBHYT(this.state.healthInsuranceCardNumber) == false) {
        toast.warning("Số bảo hiểm y tế không hợp lệ");
      } else if (this.state.idCardNumber != null && this.validateCMND(this.state.idCardNumber) == false) {
        toast.warning("Số CMND không hợp lệ");
      } else if (this.state.age < 0 || this.state.age > 120) {
        toast.warning("Tuổi không hợp lệ");
      } else if (this.state.height < 0 || this.state.height > 250) {
        toast.warning("Chiều cao không hợp lệ");
      } else if (this.state.weight < 0 || this.state.weight > 250) {
        toast.warning("Cân nặng không hợp lệ");
      } else {
        //check code và phone number
        checkDuplicate(id, obj.code, obj.phoneNumber).then((result) => {
          //Nếu trả về true là code hoặc sđt đã được sử dụng
          if (result.data) {
            toast.warning('Mã hoặc số điện thoại đã được sử dụng, vui lòng thử lại.');
            this.setState({ loading: false });
          } else {
            if (id) {
              update(obj).then(() => {
                toast.success(t('toast.update_success'));
                this.setState({ loading: false })
                this.props.handleClose()
              });
            } else {
              addNew(obj).then((response) => {
                if (response.data != null && response.status === 200) {
                  this.state.id = response.data.id
                  this.setState({ ...this.state, loading: false })
                  toast.success(t('toast.add_success'));
                  this.props.handleClose()
                }
              });
            }
          }
        });
      }
    }
  };
  handleSelectdministrativeUnit = (value, source) => {
    //thành phố
    if ("provinceOfResidence" == source) {
      this.setState({ provinceOfResidence: value });

      if (value != null) {
        this.setState({
          districtOfResidenceSearch: {
            pageIndex: 0,
            pageSize: 10000000,
            parentId: value.id,
          },
          districtOfResidence: null,
          wardOfResidence: null,
          residentialArea: null,
          administrativeUnit: null,
        });
      } else {
        this.setState({ districtOfResidence: null });
        this.setState({ wardOfResidence: null });
        this.setState({ administrativeUnit: null });
        this.setState({
          districtOfResidenceSearch: { pageIndex: 0, pageSize: 10000000 },
        });
        this.setState({
          wardOfResidenceSearch: { pageIndex: 0, pageSize: 10000000 },
        });
        this.setState({
          residentialAreaSearch: { pageIndex: 0, pageSize: 10000000 }
        })
        this.setState({
          hamletOfResidenceSearch: { pageIndex: 0, pageSize: 10000000 },
        });
      }
    }
    //quận
    if ("districtOfResidence" == source) {
      this.setState({ districtOfResidence: value });
      if (value != null) {
        this.setState({
          wardOfResidenceSearch: {
            pageIndex: 0,
            pageSize: 10000000,
            parentId: value.id,
          },
          wardOfResidence: null,
        });
      } else {
        this.setState({ wardOfResidence: null, residentialArea: null, administrativeUnit: null });
        this.setState({
          wardOfResidenceSearch: { pageIndex: 0, pageSize: 10000000 },
        });
      }
    }
    //phường
    if ("wardOfResidence" == source) {
      this.setState({ wardOfResidence: value });
      if (value != null) {
        this.setState({
          residentialAreaSearch: {
            pageIndex: 0,
            pageSize: 10000000,
            parentId: value.id,
          },
          residentialArea: null,
          administrativeUnit: null,
        });
      } else {
        this.setState({ residentialArea: null, administrativeUnit: null });
        this.setState({
          residentialAreaSearch: { pageIndex: 0, pageSize: 10000000 }
        });
      }
    }
    //Khu cách ly
    if ("residentialArea" == source) {
      this.setState({ residentialArea: value });
      if (value != null) {
        this.setState({
          hamletOfResidenceSearch: {
            pageIndex: 0,
            pageSize: 10000000,
            parentId: value.id,
          },
          administrativeUnit: null,
        });
      } else {
        this.setState({ administrativeUnit: null });
        this.setState({
          hamletOfResidenceSearch: { pageIndex: 0, pageSize: 10000000 }
        });
      }
    }
    //Phòng cách ly
    if ("administrativeUnit" == source) {
      this.setState({ administrativeUnit: value });
    }
  };

  componentDidMount() {
    ValidatorForm.addValidationRule('isPasswordMatch', (value) => {
      if (value !== this.state.password) {
        return false;
      }
      return true;
    });
  }

  componentWillUnmount() {
    ValidatorForm.removeValidationRule('isPasswordMatch');
  }

  componentWillMount() {
    let { open, handleClose, item, isUser } = this.props;
    let { provinceOfResidence, districtOfResidence, residentialArea, wardOfResidence, provinceOfResidenceSearch } = this.state;
    if (item && item.administrativeUnit) {
      if (item.administrativeUnit.parent) {
        residentialArea = item.administrativeUnit.parent;
        if (residentialArea.parent) {
          wardOfResidence = residentialArea.parent;
          if (wardOfResidence.parent) {
            districtOfResidence = wardOfResidence.parent;
            if (districtOfResidence.parent) {
              provinceOfResidence = districtOfResidence.parent;
            }
          }
        }
      }
    }
    if (provinceOfResidence) {
      this.handleSelectdministrativeUnit(provinceOfResidence, "provinceOfResidence")
      if (districtOfResidence) {
        this.handleSelectdministrativeUnit(districtOfResidence, "districtOfResidence")
        if (wardOfResidence) {
          this.handleSelectdministrativeUnit(wardOfResidence, "wardOfResidence")
          if (residentialArea) {
            this.handleSelectdministrativeUnit(residentialArea, "residentialArea")
          }
        }
      }
    }
    else {
      getAdministrativeUnitByPage(provinceOfResidenceSearch).then(({ data }) => {
        if (data && data.content) {
          provinceOfResidence = data.content.find((element) => element.name === "Hồ Chí Minh")
          if (provinceOfResidence) {
            this.handleSelectdministrativeUnit(provinceOfResidence, "provinceOfResidence");
            if (provinceOfResidence.subAdministrativeUnitsDto && provinceOfResidence.subAdministrativeUnitsDto.length > 0) {
              districtOfResidence = provinceOfResidence.subAdministrativeUnitsDto.find((element) => element.name === "Quận 5")
              this.handleSelectdministrativeUnit(districtOfResidence, "districtOfResidence");
            }
          }
        }
      })
    }

    getBackgroundDisease({ pageIndex: 0, pageSize: 1000 }).then(({ data }) => {
      this.setState({ listDataBackgroundDisease: [...data.content] });
    })

    if (!item.id) {
      this.setState({ isAddNew: true });
    }
    console.log(item);
    this.setState({ ...item });
    if (item.familyMembers && item.familyMembers[0] && item.familyMembers[0].member) {
      let member = item.familyMembers[0].member;
      let backgroundDiseases = [];
      if (member.listBackgroundDisease) {
        member.listBackgroundDisease.forEach(element => {
          backgroundDiseases.push(element.backgroundDisease);
        });
      }
      this.setState({
        idCardNumber: member.idCardNumber,
        healthInsuranceCardNumber: member.healthInsuranceCardNumber,
        gender: member.gender,
        isPregnant: member.isPregnant,
        height: member.height,
        weight: member.weight,
        email: member.email,
        haveBackgroundDisease: member.haveBackgroundDisease,
        backgroundDiseases: backgroundDiseases
      })
      
    }
  }

  selectListBackgroundDisease = (values) => {
    this.setState({ backgroundDiseases: values });
  };

  render() {
    let { open, handleClose, handleOKEditClose, t, i18n, readOnly, isUser } = this.props;
    let {
      id,
      name,
      code,
      phoneNumber,
      age,
      password,
      isAddNew,
      confirmPassword,
      detailAddress,
      districtOfResidence,
      wardOfResidence,
      wardOfResidenceSearch,
      administrativeUnit,
      hamletOfResidenceSearch,
      provinceOfResidence,
      provinceOfResidenceSearch,
      districtOfResidenceSearch,
      familyMembers,
      residentialArea,
      residentialAreaSearch,
      email,
      changePass,
      idCardNumber,
      healthInsuranceCardNumber,
      gender,
      isPregnant,
      height,
      weight,
      listDataBackgroundDisease,
      haveBackgroundDisease,
      backgroundDiseases
    } = this.state;
    return (
      <Dialog

        open={open}
        PaperComponent={PaperComponent}
        fullWidth
        maxWidth="md"
      >
        <DialogTitle
        // className="dialog-header bgc-primary-d1"
        // style={{ cursor: 'move' }}
        // id="draggable-dialog-title"
        >
          <span className="mb-20" > {(readOnly ? 'Thông tin' : (id ? "Cập nhật" : t("general.button.add")) + " Bệnh nhân")} </span>
          <IconButton style={{ position: "absolute", right: "5px", top: "5px" }} onClick={() => handleClose()}>
            <Icon color="error" title={t("general.button.close")}>close</Icon>
          </IconButton>
        </DialogTitle>

        <ValidatorForm ref="form" onSubmit={this.handleFormSubmit} style={{
          overflowY: "auto",
          display: "flex",
          flexDirection: "column"
        }}>
          <div className="">
            <DialogContent className="o-hidden">
              <Grid container spacing={2}>
                {!isUser &&
                  <Grid item md={6} sm={12} xs={12}>
                    <TextValidator
                      className="w-100"
                      label={<span className="font">
                        <span style={{ color: "red" }}> *</span>
                        {t('Mã bệnh nhân')}
                      </span>
                      }
                      // onChange={this.handleChange}
                      type="text"
                      name="code"
                      value={code}
                      validators={["required"]}
                      errorMessages={[t("general.errorMessages_required")]}
                      variant="outlined"
                      size="small"
                      disabled
                    />
                  </Grid>
                }
                <Grid item md={6} sm={12} xs={12}>
                  <TextValidator
                    disabled={readOnly}
                    className="w-100"
                    label={<span className="font">
                      <span style={{ color: "red" }}> *</span>
                      {t('Họ và tên')}
                    </span>
                    }
                    onChange={this.handleChange}
                    type="text"
                    name="name"
                    value={name}
                    validators={["required"]}
                    errorMessages={[t("general.errorMessages_required")]}
                    variant="outlined"
                    size="small"
                  />
                </Grid>

                <Grid item md={3} sm={12} xs={12}>
                  <TextValidator
                    disabled={readOnly}
                    className="w-100"
                    label={<span className="font">
                      <span style={{ color: "red" }}> *</span>
                      {t('Tuổi')}
                    </span>
                    }
                    onChange={this.handleChange}
                    type="number"
                    name="age"
                    value={age}
                    validators={["required"]}
                    errorMessages={[t("general.errorMessages_required")]}
                    variant="outlined"
                    size="small"
                  />
                </Grid>

                <Grid item md={3} sm={12} xs={12}>
                  <TextValidator
                    disabled={readOnly}
                    className="w-100"
                    label={<span className="font">
                      <span style={{ color: "red" }}> *</span>
                      {t('SĐT')}
                    </span>
                    }
                    onChange={this.handleChange}
                    type="text"
                    name="phoneNumber"
                    value={phoneNumber}
                    validators={["required"]}
                    errorMessages={[t("general.errorMessages_required")]}
                    variant="outlined"
                    size="small"
                   
                  />
                </Grid>
                <Grid item lg={3} md={3} sm={12} xs={12}>
                  <TextValidator
                    disabled={readOnly}
                    className="w-100"
                    label={
                      <span className="font">
                        <span style={{ color: "red" }}> *</span>Cân nặng(kg)
                      </span>
                    }
                    onChange={this.handleChange}
                    type="text"
                    name="weight"
                    value={weight ? weight : ''}
                    variant="outlined"
                    validators={["required", 'isFloat']}
                    errorMessages={[t("general.errorMessages_required"), t('general.isFloat')]}
                    size="small"
                    step={0.0001}
                  />
                </Grid>
                <Grid item lg={3} md={3} sm={12} xs={12}>
                  <TextValidator
                    disabled={readOnly}
                    className="w-100"
                    label={
                      <span className="font">
                        <span style={{ color: "red" }}> *</span>Chiều cao(cm)
                      </span>
                    }
                    onChange={this.handleChange}
                    type="text"
                    name="height"
                    value={height ? height : ''}
                    variant="outlined"
                    validators={["required", "isFloat"]}
                    errorMessages={[t("general.errorMessages_required"), t('general.isFloat')]}
                    size="small"
                    step={0.0001}
                  />
                </Grid>
                <Grid item lg={3} md={3} sm={12} xs={12} className="radio_gender">
                  <FormControl component="fieldset" error={this.state.radioErrorGender}
                    disabled={readOnly}>
                    <FormLabel component="legend"><span style={{ color: "red" }}> *</span>Giới tính: </FormLabel>
                    <RadioGroup row className="radio_group_gender"
                      aria-label="position" name="position" defaultValue={gender? gender: null}
                      onChange={(value) => { this.handleChange(value, "gender") }}
                    >
                      <FormControlLabel
                        value="M"
                        control={<Radio />}
                        label="Nam"
                        labelPlacement="end"
                      />
                      <FormControlLabel
                        value="F"
                        control={<Radio />}
                        label="Nữ"
                        labelPlacement="end"
                      />
                    </RadioGroup>
                    <FormHelperText>{this.state.radioHelperTextGender}</FormHelperText>
                  </FormControl>
                </Grid>

                <Grid item lg={3} md={3} sm={12} xs={12}>
                  <div style={{ display: gender == "F" ? "block" : "none" }}>
                    <FormControlLabel
                      disabled={readOnly}
                      control={
                        <Checkbox
                          checked={isPregnant ? isPregnant : false}
                          onChange={(value) => this.handleChange(value, "isPregnant") }
                          name="isPregnant"
                        />
                      }
                      label="Có mang thai"
                    />
                  </div>
                </Grid>
                <Grid item lg={3} md={3} sm={12} xs={12}>
                  <FormControl component="fieldset" error={this.state.radioError}
                    disabled={readOnly}>
                    <FormLabel component="legend"><span style={{ color: "red" }}> *</span>Có bệnh nền: </FormLabel>
                    <RadioGroup row aria-label="haveBackgroundDisease" name="haveBackgroundDisease"
                      value={haveBackgroundDisease}
                      onChange={(event) => {
                        console.log(event.target.value);
                        if (event.target.value === "true") {
                          haveBackgroundDisease = true;
                        }
                        else {
                          haveBackgroundDisease = false;
                          backgroundDiseases = [];
                        }
                        this.setState({ haveBackgroundDisease, radioHelperText: "", radioError: false })
                      }}>
                      <FormControlLabel value={true}
                        control={<Radio checked={ haveBackgroundDisease === true ? true : false} />}
                        label="Có" />
                      <FormControlLabel value={false}
                        control={<Radio checked={ haveBackgroundDisease === false ? true : false} />}
                        label="Không" />
                    </RadioGroup>
                    <FormHelperText>{this.state.radioHelperText}</FormHelperText>


                  </FormControl>
                </Grid>
                <Grid item lg={9} md={9} sm={12} xs={12}>
                  {haveBackgroundDisease &&
                    <Autocomplete
                      disabled={readOnly}
                      style={{ width: "100%" }}
                      multiple
                      id="combo-box-demo"
                      defaultValue={backgroundDiseases ? backgroundDiseases : []}
                      options={listDataBackgroundDisease ? listDataBackgroundDisease : []}
                      getOptionSelected={(option, value) =>
                        option.id === value.id
                      }
                      getOptionLabel={(option) => option.name}
                      onChange={(event, value) => {
                        this.selectListBackgroundDisease(value);
                      }}
                      renderInput={(params) => (
                        <TextValidator
                          disabled={readOnly}
                          {...params}
                          value={backgroundDiseases ? backgroundDiseases : []}
                          label={
                            <span className="font">
                              {t("Tiền sử bệnh")}
                            </span>
                          }
                          variant="outlined"
                          size="small"
                          fullWidth
                        />
                      )}
                    />}
                </Grid>
                <Grid item lg={6} md={6} sm={12} xs={12}>
                  <TextValidator
                    disabled={readOnly}
                    className="w-100"
                    label={
                      <span className="font">
                        Số thẻ bảo hiểm y tế
                      </span>
                    }
                    onChange={this.handleChange}
                    type="text"
                    name="healthInsuranceCardNumber"
                    value={healthInsuranceCardNumber ? healthInsuranceCardNumber : ''}
                    variant="outlined"
                    // validators={["required"]}
                    // errorMessages={[t("general.errorMessages_required")]}
                    size="small"
                  />
                </Grid>
                <Grid item lg={6} md={6} sm={12} xs={12}>
                  <TextValidator
                    disabled={readOnly}
                    className="w-100"
                    label={
                      <span className="font">
                        Số CMND
                      </span>
                    }
                    onChange={this.handleChange}
                    type="text"
                    name="idCardNumber"
                    value={idCardNumber ? idCardNumber : ''}
                    variant="outlined"
                    // validators={["required"]}
                    // errorMessages={[t("general.errorMessages_required")]}
                    size="small"
                  />
                </Grid>
                <Grid item lg={6} md={6} sm={12} xs={12}>
                  <TextValidator
                    disabled={readOnly}
                    className="w-100"
                    label={
                      <span className="font">
                        Địa chỉ email
                      </span>
                    }
                    onChange={this.handleChange}
                    type="text"
                    name="email"
                    value={email ? email : ''}
                    validators={['isEmail']}
                    errorMessages={['Địa chỉ email không hợp lệ']}
                    variant="outlined"
                    size="small"
                  />
                </Grid>
                {isAddNew != null && isAddNew == true && (
                  <Grid item md={3} sm={12} sm={12}>
                    <TextValidator
                      disabled={readOnly}
                      className="w-100"
                      label={
                        <span className="font">
                          <span style={{ color: "red" }}>*</span>
                          {t("user.password")}
                        </span>
                      }
                      variant="outlined"
                      size="small"
                      onChange={this.handleChange}
                      name="password"
                      type="password"
                      value={password}
                      validators={["required", "matchRegexp:([A-Za-z0-9]{6,})"]}
                      errorMessages={[
                        t("general.errorMessages_required"),
                        t("user.password_message"),
                      ]}
                    />
                  </Grid>)}
                {isAddNew != null && isAddNew == true && (
                  <Grid item md={3} sm={12} sm={12}>
                    <TextValidator
                      disabled={readOnly}
                      className="w-100"
                      label={
                        <span className="font">
                          <span style={{ color: "red" }}>*</span>
                          {t("user.re_password")}
                        </span>
                      }
                      variant="outlined"
                      size="small"
                      onChange={this.handleChange}
                      name="confirmPassword"
                      type="password"
                      value={confirmPassword}
                      validators={["required", "isPasswordMatch"]}
                      errorMessages={[
                        t("general.errorMessages_required"),
                        t("user.password_match_message"),
                      ]}
                    />
                  </Grid>
                )}
                {/* Đơn vị hành chính */}
                <Grid item lg={6} md={6} sm={12} xs={12}>
                  {!readOnly && <AsynchronousAutocomplete
                    label={
                      <span className="font">
                        <span style={{ color: "red" }}> * </span>
                        {t("Tỉnh/Thành Phố")}
                      </span>
                    }
                    searchFunction={getAdministrativeUnitByPage}
                    searchObject={provinceOfResidenceSearch}
                    value={provinceOfResidence ? provinceOfResidence : null}
                    multiple={false}
                    defaultValue={
                      provinceOfResidence ? provinceOfResidence : null
                    }
                    displayLable={"name"}
                    className="w-100"
                    validators={["required"]}
                    errorMessages={[t("general.errorMessages_required")]}
                    onSelect={(value) => {
                      this.handleSelectdministrativeUnit(
                        value,
                        "provinceOfResidence"
                      );
                    }}
                    variant="outlined"
                    size="small"
                  />}
                  {readOnly && <TextValidator
                    disabled={readOnly}
                    className="w-100"
                    label={
                      <span className="font">
                        <span style={{ color: "red" }}> * </span>
                        {t("Tỉnh/Thành Phố")}
                      </span>
                    }
                    variant="outlined"
                    size="small"
                    name="provinceOfResidence"
                    type="text"
                    value={provinceOfResidence ? (provinceOfResidence.name ? provinceOfResidence.name : '') : ''}
                  />}
                </Grid>
                <Grid item lg={6} md={6} sm={12} xs={12}>
                  {!readOnly && <AsynchronousAutocomplete
                    disabled={readOnly}
                    label={
                      <span className="font">
                        <span style={{ color: "red" }}> * </span>
                        {t("Quận huyện")}
                      </span>
                    }
                    searchFunction={getAdministrativeUnitByPage}
                    searchObject={districtOfResidenceSearch}
                    value={districtOfResidence ? districtOfResidence : null}
                    multiple={false}
                    defaultValue={
                      districtOfResidence ? districtOfResidence : null
                    }
                    displayLable={"name"}
                    className="w-100"
                    validators={["required"]}
                    errorMessages={[t("general.errorMessages_required")]}
                    onSelect={(value) => {
                      this.handleSelectdministrativeUnit(
                        value,
                        "districtOfResidence"
                      );
                    }}
                    variant="outlined"
                    size="small"
                  />}
                  {readOnly && <TextValidator
                    disabled={readOnly}
                    className="w-100"
                    label={
                      <span className="font">
                        <span style={{ color: "red" }}> * </span>
                        {t("Quận huyện")}
                      </span>
                    }
                    variant="outlined"
                    size="small"
                    name="districtOfResidence"
                    type="text"
                    value={districtOfResidence ? (districtOfResidence.name ? districtOfResidence.name : '') : ''}
                  />}
                </Grid>
                <Grid item lg={6} md={6} sm={12} xs={12}>
                  {!readOnly && <AsynchronousAutocomplete
                    disabled={readOnly}
                    label={
                      <span className="font">
                        <span style={{ color: "red" }}> * </span>
                        {t("Xã/Phường")}
                      </span>
                    }
                    searchFunction={getAdministrativeUnitByPage}
                    searchObject={wardOfResidenceSearch}
                    value={wardOfResidence ? wardOfResidence : null}
                    multiple={false}
                    defaultValue={wardOfResidence ? wardOfResidence : null}
                    displayLable={"name"}
                    className="w-100"
                    validators={["required"]}
                    errorMessages={[t("general.errorMessages_required")]}
                    onSelect={(value) => {
                      this.handleSelectdministrativeUnit(
                        value,
                        "wardOfResidence"
                      );
                    }}
                    variant="outlined"
                    size="small"
                  />}
                  {readOnly && <TextValidator
                    disabled={readOnly}
                    className="w-100"
                    label={
                      <span className="font">
                        <span style={{ color: "red" }}> * </span>
                        {t("Xã/Phường")}
                      </span>
                    }
                    variant="outlined"
                    size="small"
                    name="wardOfResidence"
                    type="text"
                    value={wardOfResidence ? (wardOfResidence.name ? wardOfResidence.name : '') : ''}
                  />}
                </Grid>
                <Grid item lg={6} md={6} sm={12} xs={12}>
                  {!readOnly && <AsynchronousAutocomplete
                    disabled={readOnly}
                    label={
                      <span className="font">
                        <span style={{ color: "red" }}> * </span>
                        {t("Khu cách ly")}
                      </span>
                    }
                    searchFunction={getAdministrativeUnitByPage}
                    searchObject={residentialAreaSearch}
                    value={residentialArea ? residentialArea : null}
                    multiple={false}
                    defaultValue={residentialArea ? residentialArea : null}
                    displayLable={"name"}
                    className="w-100"
                    validators={["required"]}
                    errorMessages={[t("general.errorMessages_required")]}
                    onSelect={(value) => {
                      this.handleSelectdministrativeUnit(
                        value,
                        "residentialArea"
                      );
                    }}
                    variant="outlined"
                    size="small"
                  />}
                  {readOnly && <TextValidator
                    disabled={readOnly}
                    className="w-100"
                    label={
                      <span className="font">
                        <span style={{ color: "red" }}> * </span>
                        {t("Khu cách ly")}
                      </span>
                    }
                    variant="outlined"
                    size="small"
                    name="residentialArea"
                    type="text"
                    value={residentialArea ? (residentialArea.name ? residentialArea.name : '') : ''}
                  />}
                </Grid>
                <Grid item lg={6} md={6} sm={12} xs={12}>
                  {!readOnly && <AsynchronousAutocomplete
                    disabled={readOnly}
                    label={
                      <span className="font">
                        <span style={{ color: "red" }}> * </span>
                        {t("Phòng cách ly")}
                      </span>
                    }
                    searchFunction={getAdministrativeUnitByPage}
                    searchObject={hamletOfResidenceSearch}
                    value={administrativeUnit ? administrativeUnit : null}
                    multiple={false}
                    defaultValue={administrativeUnit ? administrativeUnit : null}
                    displayLable={"name"}
                    className="w-100"
                    validators={["required"]}
                    errorMessages={[t("general.errorMessages_required")]}
                    onSelect={(value) => {
                      this.handleSelectdministrativeUnit(
                        value,
                        "administrativeUnit"
                      );
                    }}
                    variant="outlined"
                    size="small"
                  />}
                  {readOnly && <TextValidator
                    disabled={readOnly}
                    className="w-100"
                    label={
                      <span className="font">
                        <span style={{ color: "red" }}> * </span>
                        {t("Phòng cách ly")}
                      </span>
                    }
                    variant="outlined"
                    size="small"
                    name="administrativeUnit"
                    type="text"
                    value={administrativeUnit ? (administrativeUnit.name ? administrativeUnit.name : '') : ''}
                  />}
                </Grid>

                <Grid item md={12} sm={12} xs={12}>
                  <TextValidator
                    disabled={readOnly}
                    className="w-100 mb-16"
                    label={<span className="font">
                      <span style={{ color: "red" }}> *</span>
                      {t('Địa chỉ nơi ở')}
                    </span>
                    }
                    multiline
                    rowsMax={4}
                    onChange={this.handleChange}
                    type="text"
                    name="detailAddress"
                    value={detailAddress}
                    validators={["required"]}
                    errorMessages={[t("general.errorMessages_required")]}
                    variant="outlined"
                    size="small"
                  />
                </Grid>

                {/* {familyMembers && <Grid item xs={12}>
                  <fieldset className="member_table--wrapper">
                    <legend>Danh sách thành viên trong hộ gia đình </legend>
                    <table className="member_table" border={1} style={{ 'width': '100%', overflow: 'auto' }}>
                      <tr>
                        <th>STT</th>
                        <th>Họ tên</th>
                        <th>Tuổi</th>
                        <th>Điện thoại</th>
                      </tr>
                      {familyMembers && (familyMembers).map((element, index) => {
                        if (element.member) {
                          return (
                            <tr>
                              <td>{index + 1}</td>
                              <td>{element.member.displayName}</td>
                              <td>{element.member.age}</td>
                              <td>{element.member.phoneNumber}</td>
                            </tr>
                          )
                        }
                      })}
                    </table>
                  </fieldset>

                </Grid>} */}
              </Grid>
            </DialogContent>
          </div>
          <DialogActions spacing={4} className="flex flex-end flex-middle">
            <Button
              startIcon={<BlockIcon />}
              variant="contained"
              className="mr-12"
              color="secondary"
              onClick={() => handleClose()}
            >
              {t("general.button.cancel")}
            </Button>
            {!readOnly &&
              <Button
                startIcon={<SaveIcon />}
                className="mr-12"
                variant="contained"
                color="primary"
                type="submit">
                {t("general.button.save")}
              </Button>}
          </DialogActions>
        </ValidatorForm>

      </Dialog >
    );
  }
}

export default EditorDialog;
